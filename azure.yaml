# yaml-language-server: $schema=https://raw.githubusercontent.com/Azure/azure-dev/main/schemas/v1.0/azure.yaml.json

name: azure-foundry-iac
metadata:
  template: azure-foundry-iac@0.0.1

# Infrastructure configuration
infra:
  provider: bicep
  path: infra
  module: main
  parameters:
    - name: namePrefix
      value: "{{ .Env.namePrefix }}"
    - name: location
      value: "{{ .Env.location }}"
    - name: resourceGroupName
      value: "{{ .Env.resourceGroupName }}"
    - name: kvName
      value: "{{ .Env.kvName }}"
    - name: storageName
      value: "{{ .Env.storageName }}"
    - name: aiServicesName
      value: "{{ .Env.aiServicesName }}"
    - name: aiServicesSubdomain
      value: "{{ .Env.aiServicesSubdomain }}"
    - name: connectionAuthType
      value: "{{ .Env.connectionAuthType }}"

# Deployment hooks - prompt for environment-specific settings
hooks:
  preprovision:
    posix:
      shell: sh
      run: |
        echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
        echo "â•‘         Azure AI Foundry - Multi-Subscription Deployment       â•‘"
        echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        echo "This deployment supports separate subscriptions per environment."
        echo "You will be prompted for subscription and resource group details."
        echo ""
    windows:
      shell: pwsh
      run: |
        Write-Host "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Cyan
        Write-Host "â•‘         Azure AI Foundry - Multi-Subscription Deployment       â•‘" -ForegroundColor Cyan
        Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Cyan
        Write-Host ""
        Write-Host "This deployment supports separate subscriptions per environment." -ForegroundColor Yellow
        Write-Host "You will be prompted for subscription and resource group details." -ForegroundColor Yellow
        Write-Host ""
  
  postprovision:
    posix:
      shell: sh
      run: |
        echo ""
        echo "âœ… Deployment completed successfully!"
        echo ""
        echo "ğŸ“Š Deployment Summary:"
        echo "   Environment: ${AZURE_ENV_NAME}"
        echo "   Subscription: ${AZURE_SUBSCRIPTION_ID}"
        echo "   Resource Group: ${AZURE_RESOURCE_GROUP}"
        echo "   Location: ${AZURE_LOCATION}"
        echo ""
    windows:
      shell: pwsh
      run: |
        Write-Host ""
        Write-Host "âœ… Deployment completed successfully!" -ForegroundColor Green
        Write-Host ""
        Write-Host "ğŸ“Š Deployment Summary:" -ForegroundColor Cyan
        Write-Host "   Environment: $env:AZURE_ENV_NAME" -ForegroundColor White
        Write-Host "   Subscription: $env:AZURE_SUBSCRIPTION_ID" -ForegroundColor White
        Write-Host "   Resource Group: $env:AZURE_RESOURCE_GROUP" -ForegroundColor White
        Write-Host "   Location: $env:AZURE_LOCATION" -ForegroundColor White
        Write-Host ""
